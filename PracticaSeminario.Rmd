---
title: Seminario de Fuentes de datos biomédicas y web semántica
author:    | 
 | **David Sainz Gonzalo**
 | *[email](mailto:dsg1003@alu.ubu.es)*
 | **Diego Trascasa García**
 | *[email](mailto:dtg1003@alu.ubu.es)*
date: "5º Semestre / Curso 2022-2023"
output:
  html_document:
    df_print: paged
  pdf_document: 
    toc: yes
always_allow_html: true
---

# EFECTO DE LA CALIDAD DE AIRE EN DISTINTAS ENFERMEDADES

##Importación de los datos de Enfermedades.
Lo primero que realizamos es la importación de los datos de las enfermedades, lo hacemos a través de un archivo csv.

```{r Datos de Enfermedades}
library(readr)
X49971 <- read_delim("input/data/Enfermedades/49971.csv", 
    delim = "\t", escape_double = FALSE, 
    trim_ws = TRUE)
View(X49971)
```
Con el bloque de codigo anterior obtenemos una tabla con 7 columnas: 
Nacional, Comunidades y ciudades autónomas, Causa de Muerte, Sexo, Lugar de Ocurrencia, Año y Total. 
Obtemos un total de 214,200 entradas.
Esta tabla no va a ser necesario modificarla para su posterior comparación.


##Importación de los datos de Calidad de aire.

En este caso vamos a importar los datos de Calidad del aire de forma separada, se encuentran en varias tablas dependiendo del año y las magnitudes de calidad.

Año 2020:

```{r}
library(readr)
As_DD_2021 <- read_delim("input/data/calidad del aire/2020/As_DD_2021.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
View(As_DD_2021)

library(readr)
BaP_DD_2021 <- read_delim("input/data/calidad del aire/2020/BaP_DD_2021.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
View(BaP_DD_2021)

library(readr)
Cd_DD_2021 <- read_delim("input/data/calidad del aire/2020/Cd_DD_2021.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
View(Cd_DD_2021)

library(readr)
Ni_DD_2021 <- read_delim("input/data/calidad del aire/2020/Ni_DD_2021.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
View(Ni_DD_2021)

library(readr)
Pb_DD_2021 <- read_delim("input/data/calidad del aire/2020/Pb_DD_2021.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
View(Pb_DD_2021)

library(readr)
PM10_DD_2021 <- read_delim("input/data/calidad del aire/2020/PM10_DD_2021.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
View(PM10_DD_2021)

library(readr)
PM25_DD_2021 <- read_delim("input/data/calidad del aire/2020/PM25_DD_2021.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
View(PM25_DD_2021)
```

Ahora tenemos que modificar las distintas tablas importadas anteriormente para conseguir tratar los datos de calidad de aire en una única tabla.

```{r}
##Arsenico 2020
tablaAS_2020 <- select(.data = As_DD_2021, PROVINCIA, ANNO, D01:D31 )

tablaAS_2020 <-rename(.data = tablaAS_2020, AÑO = ANNO)

tabAS_2020 <- tablaAS_2020 %>%
  group_by(PROVINCIA,AÑO) %>%
  summarise(across(c(D01:D31), ~ mean(.x, na.rm = TRUE)))

tabAS_2020$ARSENICO <- apply(tabAS_2020[ ,c(3:33)], 1, mean, na.rm = TRUE)

tabAS_2020 <- select(.data = tabAS_2020, PROVINCIA, AÑO, ARSENICO)

##Benzopireno 2020
tablaBaP_2020 <- select(.data = BaP_DD_2021, PROVINCIA, ANNO, D01:D31)

tablaBaP_2020 <-rename(.data = tablaBaP_2020, AÑO = ANNO)

tabBaP_2020 <- tablaBaP_2020 %>%
  group_by(PROVINCIA,AÑO) %>%
  summarise(across(c(D01:D31), ~ mean(.x, na.rm = TRUE)))

tabBaP_2020$BENZOPIRENO <- apply(tabBaP_2020[ ,c(3:33)], 1, mean, na.rm = TRUE)

tabBaP_2020 <- select(.data = tabBaP_2020, PROVINCIA, AÑO, BENZOPIRENO)

##Cadmio 2020

tablaCd_2020 <- select(.data = Cd_DD_2021, PROVINCIA, ANNO, D01:D31)

tablaCd_2020 <-rename(.data = tablaCd_2020, AÑO = ANNO)

tabCd_2020 <- tablaCd_2020 %>%
  group_by(PROVINCIA,AÑO) %>%
  summarise(across(c(D01:D31), ~ mean(.x, na.rm = TRUE)))

tabCd_2020$CADMIO <- apply(tabCd_2020[ ,c(3:33)], 1, mean, na.rm = TRUE)

tabCd_2020 <- select(.data = tabCd_2020, PROVINCIA, AÑO, CADMIO)

##Niquel 2020

tablaNi_2020 <- select(.data = Ni_DD_2021, PROVINCIA, ANNO, D01:D31)

tablaNi_2020 <-rename(.data = tablaNi_2020, AÑO = ANNO)

tabNi_2020 <- tablaNi_2020 %>%
  group_by(PROVINCIA,AÑO) %>%
  summarise(across(c(D01:D31), ~ mean(.x, na.rm = TRUE)))

tabNi_2020$NIQUEL <- apply(tabNi_2020[ ,c(3:33)], 1, mean, na.rm = TRUE)

tabNi_2020 <- select(.data = tabNi_2020, PROVINCIA, AÑO, NIQUEL)

##Plomo 2020

tablaPb_2020 <- select(.data = Pb_DD_2021, PROVINCIA, ANNO, D01:D31)

tablaPb_2020 <-rename(.data = tablaPb_2020, AÑO = ANNO)

tabPb_2020 <- tablaPb_2020 %>%
  group_by(PROVINCIA,AÑO) %>%
  summarise(across(c(D01:D31), ~ mean(.x, na.rm = TRUE)))

tabPb_2020$PLOMO <- apply(tabPb_2020[ ,c(3:33)], 1, mean, na.rm = TRUE)

tabPb_2020 <- select(.data = tabPb_2020, PROVINCIA, AÑO, PLOMO)


##PM10 2020

tablaPM10_2020 <- select(.data = PM10_DD_2021, PROVINCIA, ANNO, D01:D31)

tablaPM10_2020 <-rename(.data = tablaPM10_2020, AÑO = ANNO)

tabPM10_2020 <- tablaPM10_2020 %>%
  group_by(PROVINCIA,AÑO) %>%
  summarise(across(c(D01:D31), ~ mean(.x, na.rm = TRUE)))

tabPM10_2020$PM_10 <- apply(tabPM10_2020[ ,c(3:33)], 1, mean, na.rm = TRUE)

tabPM10_2020 <- select(.data = tabPM10_2020, PROVINCIA, AÑO, PM_10)

##PM25 2020

tablaPM25_2020 <- select(.data = PM25_DD_2021, PROVINCIA, ANNO, D01:D31)

tablaPM25_2020 <-rename(.data = tablaPM25_2020, AÑO = ANNO)

tabPM25_2020 <- tablaPM25_2020 %>%
  group_by(PROVINCIA,AÑO) %>%
  summarise(across(c(D01:D31), ~ mean(.x, na.rm = TRUE)))

tabPM25_2020$PM_25 <- apply(tabPM25_2020[ ,c(3:33)], 1, mean, na.rm = TRUE)

tabPM25_2020 <- select(.data = tabPM25_2020, PROVINCIA, AÑO, PM_25)
```

Por cada magnitud de calidad de aire obtenemos una tabla con tres colummnas: provincia, año y dato. De la siguiente manera.
# insertar tabla aqui tabAs_2020

Para unir las 7 tablas en una única realizamos un full_join de dos en dos. De la siguiente manera:
```{r}
#union de los datos
join2020.1 <- full_join (x=tabAS_2020,y=tabBaP_2020, by=c("PROVINCIA","AÑO"))

join2020.2 <- full_join (x=join2020.1,y=tabCd_2020, by=c("PROVINCIA","AÑO"))

join2020.3 <- full_join (x=join2020.2,y=tabNi_2020, by=c("PROVINCIA","AÑO"))

join2020.4 <- full_join (x=join2020.3,y=tabPb_2020, by=c("PROVINCIA","AÑO"))

join2020.5 <- full_join (x=join2020.4,y=tabPM10_2020, by=c("PROVINCIA","AÑO"))

join2020.6 <- full_join (x=join2020.5,y=tabPM25_2020, by=c("PROVINCIA","AÑO"))
print (join2020.6)
```
A partir del código anterior obtenemos una tabla con 9 columnas que se corresponden a:
PROVINCIA, AÑO, ARSENICO, BENZOPIRENO, CADMIO, NIQUEL, PLOMO, PM_10, PM_25.

# insertar aqui la tabla join2020.6 para poder visualizarla.





















## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
